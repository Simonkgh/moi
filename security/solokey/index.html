<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Mine of Information - Solokey Concepts, Configuration and Use</title>
    <link rel="stylesheet" type="text/css" href="/assets/css/coderay.css">
    <link rel="stylesheet" type="text/css" href="/assets/css/stylesheet.css">
    <link type="application/atom+xml" title="Mine of Information" rel="alternate" href="/atom.xml"> 

    <meta name="generator" content="nanoc 4.12.15"> 
    <meta name="author" content="Simon Kitching"> 
  </head>
  <body>
    <section id="header">
      <span class='title'>The Mine of Information</span> <span class='desc'>(Nuggets of Programming and Linux)</span>
    </section>
    <div id="main">
      <section id='navpane'>
        <section>
  <ul id="navicons">
      <li class="nav">
      <a href="/" title="Home"><img src="/assets/images/Home.png"></a>
      <a href="/archives/" title="Archives"><img src="/assets/images/Calendar.png"></a>
      <a href="/site/welcome" title="E-Mail"><img src="/assets/images/Envelope.png"></a>
      <a href="/atom.xml" title="Subscribe Feed"><img src="/assets/images/RSS.png"></a>
      </li>
  </ul>
</section>

<section>
  <h1>About</h1>
  <ul id="about">
    <li>
      <a href="/site/welcome">Welcome</a>
    </li>
  </ul>
</section>

<section>
<h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2023/12/monorepos/">Monorepos and Polyrepos</a>
      </li>
    
      <li class="post">
        <a href="/2023/12/httpapis/">HTTP APIs, REST APIs, and Others</a>
      </li>
    
      <li class="post">
        <a href="/2023/09/biden/">Biden on Democracy</a>
      </li>
    
      <li class="post">
        <a href="/2023/09/tech-breadth/">Maintaining Technical Depth</a>
      </li>
    
      <li class="post">
        <a href="/2023/08/vpns/">The Uselessness of Consumer VPNs</a>
      </li>
    
      <li class="post">
        <a href="/2023/06/microservices/">Some Aspects of Implementing Microservices..</a>
      </li>
    
      <li class="post">
        <a href="/2023/06/dtest-evolution-scrum-monad/">DDD, Architecture patterns, and More..</a>
      </li>
    
      <li class="post">
        <a href="/2023/05/testing/">Should Unit Tests Verify Requirements Only?</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>Categories</h1>
  <ul id="categories">
    
      <li class="catlink">
        <a href='/category/Architecture/'>Architecture</a>
      </li>
    
      <li class="catlink">
        <a href='/category/BigData/'>BigData</a>
      </li>
    
      <li class="catlink">
        <a href='/category/Cloud/'>Cloud</a>
      </li>
    
      <li class="catlink">
        <a href='/category/Cryptography/'>Cryptography</a>
      </li>
    
      <li class="catlink">
        <a href='/category/Git/'>Git</a>
      </li>
    
      <li class="catlink">
        <a href='/category/Infrastructure/'>Infrastructure</a>
      </li>
    
      <li class="catlink">
        <a href='/category/Java/'>Java</a>
      </li>
    
      <li class="catlink">
        <a href='/category/Links/'>Links</a>
      </li>
    
      <li class="catlink">
        <a href='/category/Linux/'>Linux</a>
      </li>
    
      <li class="catlink">
        <a href='/category/Network/'>Network</a>
      </li>
    
      <li class="catlink">
        <a href='/category/OSGi/'>OSGi</a>
      </li>
    
      <li class="catlink">
        <a href='/category/Off-topic/'>Off-topic</a>
      </li>
    
      <li class="catlink">
        <a href='/category/OpenWRT/'>OpenWRT</a>
      </li>
    
      <li class="catlink">
        <a href='/category/Programming/'>Programming</a>
      </li>
    
      <li class="catlink">
        <a href='/category/Security/'>Security</a>
      </li>
    
      <li class="catlink">
        <a href='/category/Site/'>Site</a>
      </li>
    
  </ul>
</section>


      </section>
  
      <section id='content'>
        
  <div class='page'>
    <h1>Solokey Concepts, Configuration and Use</h1>
    <aside>First published on: April 26, 2019</aside>
    
    <article>
    <p>Categories: <a href='/category/Security/'>Security</a></p>
      
<h1 id="introduction">Introduction</h1>

<p>Solokeys is an organisation which <a href="https://shop.solokeys.com/">sells a family of physical devices</a> that connect to a PC, mobile phone, or similar device (via USB or NFC) and provide encryption services of various types - most importantly U2F (FIDO1) and WebAuthentication (FIDO2). A Solokey can be used for login authentication - and in future for encrypting/decrypting files, signing emails, and similar purposes.</p>

<p>There are similar devices from other providers (Yubikey, Google Titan, etc), but what makes Solokeys very interesting is that <a href="https://github.com/solokey">all hardware and software are completely open-source</a> with an active development community and <a href="https://docs.solokeys.io/solo/">a site for technical documentation</a> (though it needs improvement IMO). Given the open hardware specifications, you can theoretically build your own physical Solokey if you have the necessary skills - though in practice most people would want to buy devices from the Solokeys shop! The initial version of Solokey was developed using funding gathered via Kickstarter.</p>

<p>Solokeys are currently very new; some functionality is still being developed.</p>

<p>This site has an article <a href="/security/yubikey">specifically on Yubikey</a> which also contains a significant amount of background information on FIDO1, FIDO2, OpenPGP, and similar topics. I recommend reading that article if you are not familiar with these areas. This article is primarily about Solokey itself.</p>

<p>This article is currently very short - I only discovered the Solokey project recently. My key is on order and once I have had time to play with it, I will update this article.</p>

<p>Solokeys is effectively an “update” of the successful (but simpler) <a href="https://github.com/conorpp/u2f-zero">U2F-Zero</a> project, with the same primary technical architect.</p>

<p>WARNING: I encountered the Solokeys project only recently. All information in this article should therefore be read with caution - corrections welcome!</p>

<h1 id="status">Status</h1>

<p>At the current time (mid April 2019), Solokey versions with USB-A and USB-C support are available. The Solotap versions which add NFC support are expected to ship in the next few weeks (ie by end of April 2019).</p>

<p>Unfortunately, the software lags behind the hardware design somewhat. U2F (aka FIDO1) and WebAuthentication (aka FIDO2) support is implemented but other features are still in development. However given the active community, I don’t expect it will be long until Solokey is feature-compatible with Yubikey (their explicit goal). In particular, it is expected that the following will be implemented:</p>

<ul>
  <li>OpenPGP support (for signing documents and encrypting/decrypting files)</li>
  <li>SSH key support (for logging in via SSH servers)</li>
  <li>OATH-TOTP</li>
  <li>OATH-HOTP</li>
  <li>static password storage</li>
</ul>

<h1 id="hardware">Hardware</h1>

<p>The Solokey has either a USB-A or USB-C connector. The NFC-enabled variants have (obviously) NFC as well.</p>

<p>The NFC variant is slightly larger than the non-NFC one. However both fit comfortably on a keyring.</p>

<p>All Solokeys have an embedded button for confirmation of operations (important so that rogue software on a PC or other device the Solokey is connected to cannot initiate operations without your explicit approval). The keys also have a single multi-colour-capable LED, controlled by software.</p>

<p>The USB-A/USB-C connector is not retractable, nor does it have a cover. However this is also the case for the Yubikey, and I have not had any problems with that.</p>

<p>TODO: does the device have a battery?</p>

<p>TODO: does the device have a clock?</p>

<p>The Solokey includes dedicated hardware for random number generation.</p>

<h1 id="software">Software</h1>

<p>All hardware and software development is done via <a href="https://github.com/solokey">a set of Github projects</a>. Issue-tracking also occurs via Github.</p>

<p>Software running on the Solokey is divided into the following categories:</p>

<ul>
  <li>Device Firmware Update (DFU)</li>
  <li>Bootloader</li>
  <li>Solo Application</li>
</ul>

<p>The DFU is the lowest level of embedded firmware; the DFU provides just enough IO support to allow new firmware to be uploaded. An “uninitialized” Solokey boots into the DFU; a “hacker mode” device can be forced to boot the DFU by holding down the device button for 5 seconds. A “production mode” device cannot be forced to boot the DFU.</p>

<p>The standard bootloader is low-level code that initializes the device, and provides support for uploading new firmware - but only when the new firmware is properly signed by private keys whose public components are in the existing firmware. In other words, the standard bootloader allows its host system to replace the entire firmware (including the bootloader itself) but only under specific conditions. Because this bootloader needs support for signature verification, it is more complex than the DFU - and requires the hardware to be more completely initialised.</p>

<p>The Solo application code is linked with the bootloader to form a full firmware image. Code in the Solo application module does not deal with low-level hardware initialisation (that is done in the bootloader); instead it concentrates on providing user-level functionality (such as U2F and FIDO2 support). Making coding errors at the Solo application level are not as serious as making errors at the bootloader level because, as long as the bootloader still runs correctly, a bad version can be replaced by uploading an older or newer firmware version.</p>

<p>Client-side administration/configuration tools are implemented in Python3.</p>

<p>Note that there is no kernel-space/user-space separation for code in the Solokey - it is an embedded system, not a traditional PC. In effect, the device runs one single application - but that application can expose multiple USB devices to the host it is attached to and thus provide distinct functions.</p>

<p>TODO: where is the bootloader code in the github repos? Is this under “CBOR”?</p>

<h1 id="development-tools">Development Tools</h1>

<p>When building a firmware image, a “debug mode” can be enabled. When a Solokey with such firmware is attached to a host it registers an additional USB “serial port” device in addition to the usual USB devices used for FIDO1/FIDO2/etc. The key then sends any “debug messages” embedded in its code to that serial port, allowing a developer to monitor behaviour of software on the device.</p>

<p>Compiling on a standard developer setup but targeting the embedded platform requires a cross-compiler; to make this easy, a docker image containing the necessary cross-compiler is provided by the project. Alternatively you can install the necessary ARM-targeting cross compiler explicitly.</p>

<p>The manufacturer of the ARM-based chip on which the Solokey hardware is based sells a “development board”, allowing hardware-in-the-loop testing. Or you can test directly (though less conveniently) on a “hacker mode” Solokey.</p>

<p>Although the Solokey hardware uses an ARM-based CPU, the Solo application code can also be compiled to x86 and run on a standard PC for development and testing purposes. When run in this way, the Solo application accepts USB data packets over a UDP socket rather than via a USB device node; a modified FIDO2 client app is provided which supports this USB-over-UDP hack. The Solokey bootloader code is very hardware-specific and cannot be tested in this way.</p>

<p>When compiled for running on a developer’s system (see above), the resulting binary application also provides a set of admin tools (presumably this code is not linked in when building firmware for installation on the key itself). These admin tools include:</p>

<ul>
  <li>support for signing firmware images</li>
  <li>support for uploading new firmware to a Solokey device</li>
  <li>support for displaying debug-messages emitted from a Solokey device</li>
</ul>

<h1 id="hacker-vs-production-mode">Hacker vs Production Mode</h1>

<p>A Solokey configured in “hacker mode” allows the “operating system” to be replaced (booting to the DFU is possible). However when a device is switched from “hacker mode” to “production mode” the DFU is disabled. This means that the exisiting firmware on the device (bootloader component) controls whether new firmware updates are allowed.</p>

<p>The standard bootloader implementation includes a set of public keys, and allows new firmware to be uploaded (ie to replace the current firmware) as long as the new app software package is signed with a private key that corresponds to a public key embedded in the current firmware. This allows firmware to be safely updated on a Solokey in production mode.</p>

<p>Solokeys can be purchased in either hacker mode or production mode; both have the standard software preinstalled.  When purchased in production mode, the firmware contains only keys belonging to the core Solokey organisation - and thus new versions of apps can only be installed when signed by that organisation. This is effectively the same as purchasing a Yubikey, Titan, or similar except that:</p>

<ul>
  <li>device sourcecode is available to read</li>
  <li>client (admin) software is open-source and modifiable</li>
  <li>and contributions to either device or client software can be submitted via the github project</li>
</ul>

<p>When purchased in hacker mode, the device is fully functional; you can use it for holding your U2F/FIDO2 keys etc. However if it is stolen then an attacker could potentially replace the firmware with a different version that reveals keys stored on the device.</p>

<p>It is relatively easy to modify the official firmware to add your own public keys as “supported app signing keys”. This makes it possible for you to update firmware on the device even after it is set to production mode (as long as you do not lose the corresponding private key!).</p>

<h1 id="backing-up-credentials">Backing Up Credentials</h1>

<p>One of the significant concerns I had with Yubikey’s FIDO2 support is the issue of backups. With FIDO2, each service you authenticate with requires its own public/private key pair stored in the device. This is nice, as there are no “shared credentials” between sites. However these keys are generated <em>on the key itself</em>, and Yubikey currently provides no way at all to back up such keys. This means that if you lose the key, you lose access to that account unless you also define “alternative credentials”.</p>

<p>One alternative credential would be to sign up using a different Yubikey, ie to have two keys. However you would need to have access to both keys whenever signing up to a new service - and having the “backup device” always near the “primary device” creates a high risk of losing both at the same time.</p>

<p>An alternative is to have an “account recovery” process based around email/sms/etc. But that is a significant weakpoint in security - an attacker can potentially use the “recovery” process to access your account.</p>

<p>It isn’t currently clear whether Solokey’s official software has a “backup” concept - but if not, someone (possibly me) can implement one.</p>

<h1 id="host-to-device-communications">Host-to-Device Communications</h1>

<p>In order to provide FIDO2 (CTAP2) support compatible with existing clients, the Solokey needs to support the CTAP2 protocol. This in turn means it needs to register itself with the host device as a USB HID device, and exchange CTAP2-specific messages over this USBHID connection.</p>

<p>U2F (FIDO1/CTAP1) support is also provided via a USB HID device node. As far as I know, the same device node is used, with different USB data packet types.</p>

<p>When the standard firmware is compiled with the appropriate DEBUG flag then the Solokey also registers itself as a USB Serial Port device, and outputs logmessages from the application over this port (one-way only).</p>

<p>If support for other protocols is added (eg TOTP/HOTP) then the device may in future register itself as a device providing additional USB interfaces.</p>

    </article>
  </div>
    
    <div id="disqus_thread"></div>
    <script type="text/javascript">
      var disqus_shortname = 'mineofinformation'; // mineofinformation (disqus site id)
      var disqus_pageid = '/security/solokey/'; // /relative/path/to/article/dir

      var disqus_config = function () {
        this.page.identifier = disqus_pageid;
        this.page.url = 'https://moi.vonos.net' + disqus_pageid;
      };
      (function() {
        var d = document, s = d.createElement('script');
        s.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
      })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
  



      </section>
    </div>
    <section id="footer">
      <p>Copyright &copy; 2025 - Simon Kitching</p>
    </section>
  </body>
</html>

