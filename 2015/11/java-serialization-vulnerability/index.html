<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Mine of Information - A Java Serialization Vulnerability</title>
    <link rel="stylesheet" type="text/css" href="/assets/css/coderay.css">
    <link rel="stylesheet" type="text/css" href="/assets/css/stylesheet.css">
    <link type="application/atom+xml" title="Mine of Information" rel="alternate" href="/atom.xml"> 

    <meta name="generator" content="nanoc 4.12.15"> 
    <meta name="author" content="Simon Kitching"> 
  </head>
  <body>
    <section id="header">
      <span class='title'>The Mine of Information</span> <span class='desc'>(Nuggets of Programming and Linux)</span>
    </section>
    <div id="main">
      <section id='navpane'>
        <section>
  <ul id="navicons">
      <li class="nav">
      <a href="/" title="Home"><img src="/assets/images/Home.png"></a>
      <a href="/archives/" title="Archives"><img src="/assets/images/Calendar.png"></a>
      <a href="/site/welcome" title="E-Mail"><img src="/assets/images/Envelope.png"></a>
      <a href="/atom.xml" title="Subscribe Feed"><img src="/assets/images/RSS.png"></a>
      </li>
  </ul>
</section>

<section>
  <h1>About</h1>
  <ul id="about">
    <li>
      <a href="/site/welcome">Welcome</a>
    </li>
  </ul>
</section>

<section>
<h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2023/12/monorepos/">Monorepos and Polyrepos</a>
      </li>
    
      <li class="post">
        <a href="/2023/12/httpapis/">HTTP APIs, REST APIs, and Others</a>
      </li>
    
      <li class="post">
        <a href="/2023/09/biden/">Biden on Democracy</a>
      </li>
    
      <li class="post">
        <a href="/2023/09/tech-breadth/">Maintaining Technical Depth</a>
      </li>
    
      <li class="post">
        <a href="/2023/08/vpns/">The Uselessness of Consumer VPNs</a>
      </li>
    
      <li class="post">
        <a href="/2023/06/microservices/">Some Aspects of Implementing Microservices..</a>
      </li>
    
      <li class="post">
        <a href="/2023/06/dtest-evolution-scrum-monad/">DDD, Architecture patterns, and More..</a>
      </li>
    
      <li class="post">
        <a href="/2023/05/testing/">Should Unit Tests Verify Requirements Only?</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>Categories</h1>
  <ul id="categories">
    
      <li class="catlink">
        <a href='/category/Architecture/'>Architecture</a>
      </li>
    
      <li class="catlink">
        <a href='/category/BigData/'>BigData</a>
      </li>
    
      <li class="catlink">
        <a href='/category/Cloud/'>Cloud</a>
      </li>
    
      <li class="catlink">
        <a href='/category/Cryptography/'>Cryptography</a>
      </li>
    
      <li class="catlink">
        <a href='/category/Git/'>Git</a>
      </li>
    
      <li class="catlink">
        <a href='/category/Infrastructure/'>Infrastructure</a>
      </li>
    
      <li class="catlink">
        <a href='/category/Java/'>Java</a>
      </li>
    
      <li class="catlink">
        <a href='/category/Links/'>Links</a>
      </li>
    
      <li class="catlink">
        <a href='/category/Linux/'>Linux</a>
      </li>
    
      <li class="catlink">
        <a href='/category/Network/'>Network</a>
      </li>
    
      <li class="catlink">
        <a href='/category/OSGi/'>OSGi</a>
      </li>
    
      <li class="catlink">
        <a href='/category/Off-topic/'>Off-topic</a>
      </li>
    
      <li class="catlink">
        <a href='/category/OpenWRT/'>OpenWRT</a>
      </li>
    
      <li class="catlink">
        <a href='/category/Programming/'>Programming</a>
      </li>
    
      <li class="catlink">
        <a href='/category/Security/'>Security</a>
      </li>
    
      <li class="catlink">
        <a href='/category/Site/'>Site</a>
      </li>
    
  </ul>
</section>


      </section>
  
      <section id='content'>
        
  <div class='post'>
    <h1>A Java Serialization Vulnerability</h1>
    <aside>Posted on: November 8, 2015</aside>
    <article>
    <p>Categories: <a href='/category/Java/'>Java</a></p>
      <p>A significant security hole has recently been found in a range of widely-used Java-based applications, allowing (among other things) execution of arbitrary shell-commands on the host system. The basic problem is that:</p>

<ol>
  <li>the applications were deserializing java objects provided by an untrusted client, and</li>
  <li>had the apache-commons-collections library in their classpath, and</li>
  <li>apache-commons-collections includes a class named InvokerTransformer which does <em>lots of reflection</em> during its readObject method, guided by properties from the input-stream.</li>
</ol>

<p>The combination is nasty: a manipulated input-stream can cause the commons-collections InvokerTransformer to look up any arbitrary class (specified in the input stream), and invoke any arbitrary static method on that class (specified in the input stream) passing any arbitrary parameter (provided in the input stream). The obvious target is: class=java.lang.Runtime, method=exec(String). Game over.</p>

<p>The problems with deserializing from an untrusted stream are well known (see first reference below for example). The role of step 3 above could be filled by any vulnerable library that is in the classpath - but this commons-collections case is particularly serious as the library is in wide-spread use.</p>

<p>As noted by both Lawrence+Frohoff and FoxGlove, there are several common cases where untrusted Java objects are deserialized, including the standard RMI Registry class and some web-frameworks (eg JSF when encryption of ViewState is not enabled).</p>

<p>Programmers can best avoid introducing this kind of vulnerability by not deserializing objects from untrusted sources. If that isn’t an option then the commonly-recommended generic solution to this kind of problem is for the class initiating the deserializing to build a white-list of all classes that a valid serial-stream may contain. Sadly, for more complicated objects this is a far from trivial thing to determine and maintain. And in this particular case, “org.apache.commons.*” could well be on the “white-list”. I don’t have a better proposal though…</p>

<p>See:</p>

<ul>
  <li>
<a href="http://www.ibm.com/developerworks/library/se-lookahead/index.html">IBM DeveloperWorks: Look-ahead Java Deserialization</a> - describes the general security issue with serialization and proposes a “lookahead” (whitelist) solution (2013)</li>
  <li>
<a href="http://www.slideshare.net/frohoff1/appseccali-2015-marshalling-pickles">Lawrence and Frohoff: Marshalling Pickles</a> - the first known reference to the apache-commons-collections issue; see slide 59 (Jan 2015)</li>
  <li>
<a href="http://foxglovesecurity.com/2015/11/06/what-do-weblogic-websphere-jboss-jenkins-opennms-and-your-application-have-in-common-this-vulnerability/">FoxGlove Security: weblogic-websphere-etc vulnerability</a>- documents the development of example attacks against several products using the above issue (Nov 2015)</li>
  <li>
<a href="http://developers.slashdot.org/story/15/11/08/0346258/vulnerability-in-java-commons-library-leads-to-hundreds-of-insecure-applications">Slashdot: Vulnerability in Java Commons Library</a> - the article that initially drew my attention to the issue</li>
</ul>

<p>Update: <a href="http://openjdk.java.net/jeps/290">JEP290</a> (to be included in Java 1.9) defines some hooks into the serialization process that can at least makes “whitelisting classes that can be deserialized” easier to implement.</p>

<p>Update 2016-11-30: It appears that this vulnerability is still being actively exploited, eg <a href="https://developers.slashdot.org/story/16/11/29/2242217/muni-system-hacker-hit-others-by-scanning-for-year-old-java-vulnerability">to install ransomware on systems belonging to the San Fransisco Railway</a>.</p>


    </article>
  </div>
    
    <div id="disqus_thread"></div>
    <script type="text/javascript">
      var disqus_shortname = 'mineofinformation'; // mineofinformation (disqus site id)
      var disqus_pageid = '/posts/2015-11-08-java-serialization-vulnerability/'; // /relative/path/to/article/dir

      var disqus_config = function () {
        this.page.identifier = disqus_pageid;
        this.page.url = 'https://moi.vonos.net' + disqus_pageid;
      };
      (function() {
        var d = document, s = d.createElement('script');
        s.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
      })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
  



      </section>
    </div>
    <section id="footer">
      <p>Copyright &copy; 2025 - Simon Kitching</p>
    </section>
  </body>
</html>

